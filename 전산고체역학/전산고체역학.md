# 구조역학의 지배 방정식
힘 평형 방정식은 다음과 같다.
$$ \int_{\Omega} \mathbf{f} dV + \int_{\partial\Omega} \mathbf{t} dS = 0 \\ \Omega := \text {물체가 차지하는 부피}, \quad \partial\Omega := \text{물체의 표면} \\ \mathbf{f} := \text {단위 부피당 체적력}, \quad \mathbf{t} := \text{단위 면적당 표면력} $$

`코시 응력 텐서(Cauchy stress tensor)`를 다음을 만족하게 정의하자.
$$ \boldsymbol{\sigma} \bf {n = t} $$

$\boldsymbol \sigma$가 충분히 매끄러운 경우 힘 평형 방정식에 대입하여 다음과 같이 정리할 수 있다.
$$ \begin{equation} \begin{aligned} \int_{\Omega} \mathbf{f} dV + \int_{\partial\Omega} \boldsymbol{\sigma}\mathbf{n} dS = 0 \\ \int_{\Omega} \mathbf{f} + \text{div}(\boldsymbol{\sigma})dV = 0  \end{aligned} \end{equation} $$

임의의 $\Omega$에 대해 식(13)가 성립해야 함으로 다음이 성립한다.
$$ \begin{equation} \rm{div}(\boldsymbol\sigma) + \bf f = 0 \end{equation} $$

Weak formulation을 유도하기 위해 테스트 벡터 함수 $\bf d$와 내적하면 다음과 같이 정리할 수 있다.
$$ \begin{equation} \begin{gathered} \int_{\Omega} ( \mathrm{div}(\boldsymbol\sigma) + \mathbf {f ) \cdot d} dV  = 0. \\\\ \int_{\Omega} \mathrm{div}(\boldsymbol\sigma  \mathbf {d}) - \boldsymbol\sigma : \boldsymbol{\epsilon}  + \mathbf {f \cdot d} dV  = 0. \\\\ \int_{\Omega} \boldsymbol\sigma : \boldsymbol{\epsilon} dV = \int _{\partial\Omega} \boldsymbol\sigma  \mathbf {d \cdot n} dS + \int _{\Omega} \mathbf {f \cdot  d} dV \\\\ \int_{\Omega} \boldsymbol\sigma : \boldsymbol{\epsilon} dV = \int _{\partial\Omega} \mathbf t \cdot  \mathbf d dS + \int _{\Omega} \mathbf {f \cdot  d} dV \end{gathered} \end{equation} $$

이 방법은 `가상 일 원리(principle of virtual work)`라고도 한다. $\bf d$를 compatibility 조건과 경계 조건을 위반하지 않으면서 응력에 변화를 주지 않는 `가상 변위(virtual displacement)`로 보면 `내부 가상 일(internal virtual work)`과 `외부 가상 일(external virtual work)`이 같다는 의미를 갖기 때문이다.

Voigt notation을 사용한 응력 벡터와 변형률 벡터로 식(3)을 표현하면 다음과 같다.
$$ \begin{equation} \int_{\Omega} \boldsymbol\sigma \cdot \boldsymbol{\epsilon} dV = \int _{\partial\Omega} \mathbf t \cdot \mathbf d dS + \int _{\Omega} \mathbf {f \cdot d} dV \end{equation} $$

## 참고
[note] (Abaqus) Equilibrium and virtual work  

# 보간

## $C^0$ 보간

### $\phi : \R \rightarrow \R$
함수 $\phi : \R \rightarrow \R$를 $n$개의 `단항식(monomial)`을 갖는 `다항식(polynomial)`으로 근사하면 다음과 같이 표현할 수 있다.
$$ \phi(x) \approx \mathbf a \cdot \mathbf m(x) $$

이 떄, 서로 다른 $n$개의 $x_i$에서 $\phi(x_i)$값을 알고 있다면 $\phi(x_i) = \mathbf a \cdot \mathbf m(x_i)$를 만족하도록 $\mathbf a$를 결정할 수 있다.

위의 조건을 행렬 형태로 나타내면 다음과 같다.
$$ \boldsymbol{\hat{\phi}} = \mathbf M^T \mathbf a \\ \text{where,} \quad \mathbf M =  \begin{bmatrix} \mathbf m(x_1) & \cdots & \mathbf m(x_n) \end{bmatrix}, \quad \hat{\phi}_i = \phi(x_i) $$

따라서 $\bf a = (M^T)^{-1} \boldsymbol{\hat{\phi}}$이고 이를 원래 식에 대입하면 다음과 같다. 
$$ \begin{aligned} \phi &= \mathbf {a \cdot m} \\ &= \mathbf {m \cdot a} \\ &= \mathbf m^T (\mathbf M^T)^{-1} \boldsymbol{\hat{\phi}} \\ &= \mathbf n \cdot \boldsymbol{\hat{\phi}} \quad  \end{aligned} $$

이 때, $\mathbf n = \mathbf M^{-1} \mathbf m$은 모양 함수 벡터이고 $n_i$는 다음과 같은 Lagrange 다항식 형태로 주어진다.

$$ n_i = \prod_{\substack{j = 1 \\ j \neq i}}^n \frac{x_j - x}{x_j - x_i} $$

이와 같이 각 점에서 값을 만족하게 보간하는 방법을 `라그랑지 보간(Lagrangian interpolation)`이라고 한다.

### $\boldsymbol{\phi} : \R^d \rightarrow \R^r$
함수 $\boldsymbol{\phi} : \R^d \rightarrow \R^r$를 $n$개의 단항식을 갖는 다항식으로 근사하면 다음과 같이 표현할 수 있다.

$$ \boldsymbol{\phi}\mathbf{(x)} = \mathbf {Am(x)} \\ \mathbf A \in \R^{r \times n}$$

이 때, 서로 다른 $n$개의 $\mathbf x_i$에서 $\boldsymbol{\phi}(\mathbf x_i)$ 값을 알고 있다면 $\boldsymbol{\phi}(\mathbf x_i) = \mathbf {Am(x}_i)$를 만족하도록 $\bf A$를 결정할 수 있다. 

$\boldsymbol{\phi}$의 $i$번째 원소 $\phi_i$는 다음과 같이 표현된다.
$$ \begin{equation} \phi_i(\mathbf x) = \mathbf A_{i*} \cdot \mathbf m(\mathbf x) \end{equation} $$

$i$번째 원소가 만족해야 하는 조건을 행렬 형태로 나타내면 다음과 같다.
$$ \hat{ \boldsymbol \phi_i} = \mathbf M^T \mathbf A_{i*} \\ \text{where,} \quad \mathbf M =  \begin{bmatrix} \bf m(x^0) & \cdots & \bf m(x^n) \end{bmatrix}, \quad \hat{\phi}_{i,j} = \phi_i(\mathbf x_j)$$

따라서 $\mathbf A_{i*} = (\mathbf M^T)^{-1} \hat{ \boldsymbol \phi_i}$이고 식(5)에 대입하면 다음과 같다.

$$ \begin{aligned} \phi_i &= \mathbf A_{i*} \cdot \mathbf m \\ &= \mathbf m \cdot \mathbf A_{i*} \\ &= \mathbf m^T (\mathbf M^T)^{-1} \boldsymbol{\hat{\phi}}_i \\ &= \mathbf n \cdot \boldsymbol{\hat{\phi}}_i \end{aligned} $$

이를 각 하나의 행렬식으로 나타내면 다음과 같다.
$$ \boldsymbol{\phi} = \begin{bmatrix} n_1 & \underbrace{0 \cdots 0}_{r-1}  & n_2 & \underbrace{0 \cdots 0}_{r-1} & \cdots & n_n & 0 & \cdots & & 0 \\ 0 & n_1 & \underbrace{0 \cdots 0}_{r-2} & 0 & n_2 & \underbrace{0 \cdots 0}_{r-2} & \cdots & 0 & n_n & \underbrace{0 \cdots 0}_{r-2} \\ & & & & \vdots \\ \underbrace{0 \cdots 0}_{r-1} & n_1 & \underbrace{0 \cdots 0}_{r-1} & n_2 & \cdots & 0 &  & \cdots & & n_n \end{bmatrix} \begin{bmatrix} \boldsymbol{\phi}(\mathbf x_1) \\ \vdots \\ \boldsymbol{\phi}(\mathbf x_r) \end{bmatrix} $$

## $C^1$ 보간

### $\phi : \R \rightarrow \R$
함수 $\phi : \R \rightarrow \R$를 $2n$개의 `단항식(monomial)`을 갖는 `다항식(polynomial)`으로 근사하면 다음과 같이 표현할 수 있다.
$$ \phi(x) \approx \mathbf a \cdot \mathbf m(x) $$

이 떄, 서로 다른 $n$개의 $x_i$에서 $\phi(x_i), \phi'(x_i)$값을 알고 있다면 $\phi(x_i) = \mathbf a \cdot \mathbf m(x_i)$와 $\phi'(x_i) = \mathbf a \cdot \mathbf m'(x_i)$를 만족하도록 $\mathbf a$를 결정할 수 있다.

위의 조건을 행렬 형태로 나타내면 다음과 같다.
$$ \boldsymbol{\hat{\phi}} = \mathbf M^T \mathbf a \\ \text{where,} \quad \mathbf M =  \begin{bmatrix} \mathbf m(x_1) & \mathbf m'(x_1) & \cdots & \mathbf m(x_n) & \mathbf m'(x_n) \end{bmatrix}, \quad \boldsymbol{\hat{\phi}} = \begin{bmatrix} \phi(x_1) \\ \phi'(x_1) \\ \vdots \\ \phi(x_n) \\ \phi'(x_n) \end{bmatrix} $$

따라서 $\bf a = (M^T)^{-1} \boldsymbol{\hat{\phi}}$이고 이를 원래 식에 대입하면 다음과 같다. 
$$ \begin{aligned} \phi &= \mathbf {a \cdot m} \\ &= \mathbf {m \cdot a} \\ &= \mathbf m^T (\mathbf M^T)^{-1} \boldsymbol{\hat{\phi}} \\ &= \mathbf n \cdot \boldsymbol{\hat{\phi}} \quad  \end{aligned} $$

이와 같이 각 점에서 값과 기울기 값을 만족하게 보간하는 방법을 `에르미트 보간(Hermitian interpolation)`이라고 한다.

# 변위 기반의 유한요소모델
$\Omega$를 $N$개의 요소로 나누고 각각을 $\Omega_i(i = 1 \cdots N)$라 하자. 

$\Omega_i$가 가상 변위를 좌표와 동일한 모양함수를 써서 근사하는 `등매개변수 요소(isoparametric element)`라하면 변위는 다음과 같다.
$$ \mathbf d^i = \mathbf {N} \mathbf{\hat{d}^i}.  $$

미소 변위 이론에 따른 변형률-변위 관계식을 사용하여 변위를 구하면 다음과 같다.
$$ \boldsymbol \epsilon^i = \mathbf {B} \mathbf{\hat{d}^i}  \\ \text{where,} \quad \bf B = \partial N $$

Generalized Hooke's law를 이용하여 응력을 구하면 다음과 같다.
$$ \boldsymbol \sigma^i = \mathbf {EB} \mathbf{\hat{d}^i} $$

위에서 구한 값들을 식(4)에 대입하면 다음과 같다.
$$ \begin{gathered} \mathbf K^i  \mathbf{\hat{d}^i} = \mathbf r^i  \\\\ \text{Where,} \quad \mathbf K^i = \int_{\Omega_i} \mathbf {B^TEB} dV, \quad \mathbf r_e = \int_{\partial\Omega_i} \mathbf {b N^T  \mathbf{\hat{d}^i}} dV + \int_{\partial\Omega_i} \mathbf {tN^T} \mathbf{\hat{d}^i} dS \end{gathered}  $$

각 요소에 대한 식을 조립(assemble) 해주면 다음과 같은 전역 방정식을 얻을 수 있다.
$$ \begin{equation} \mathbf K  \mathbf{\hat{d}} = \mathbf r \end{equation} $$

식 (5)를 풀어 $\mathbf{\hat{d}}$를 구한다.

## 참고
[note] (Abaqus) Equilibrium and virtual work
[note] (Harvard) principle of virtual work and fem

## 질문
1. Surface traction이 무엇인가?
2. 왜 $t_i = \sigma_{ij}n_j$ ?
3. 왜 IVW = $\int \sigma_{ij} \delta \epsilon_{ij} dV$

# 등매개변수 요소
기하학적 형태(좌표)를 보간할 때와 변위를 보간할 때 같은 모양 함수를 사용할 경우 `등매개변수 보간(isoparametric interpolation)`이라고 한다.

# 근사 해
등매개변수 요소에서 $N_p$개 점의 변위벡터 $\bf d$를 근사하게 되면 다음과 같다.
$$ \mathbf {d = N d}_e \\ \bf d_e \in \R^{d \times N_p}, \quad \dim(N)= $$

공학 변형률 벡터와 변위 관계에 대입하면 다음과 같다.
$$ \boldsymbol \epsilon = \mathbf {Bd}_e  \\ \text{where,} \quad \bf B = \partial n $$

$\bf B$를 변형률-변위 행렬이라고 한다.

일반화된 후크의 법칙을 이용해 응력을 구하면 다음과 같다.
$$ \boldsymbol \sigma = \mathbf {EBd}_e $$

위에서 구한 관계식들을 가상 일 원리에 대입하면 다음과 같다.
$$  \mathbf {K d}_e = \mathbf r_e  \\ \mathbf K = \mathbf {\int B^TEB} dV, \quad \mathbf r_e = \int \mathbf {N^Tb} dV + \int \mathbf {N^Tt} dS $$
